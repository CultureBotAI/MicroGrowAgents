{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"MicroGrowAgents","text":"<p>Agent-based system for microbial growth predictions</p> <ul> <li>Auto-generated schema documentation</li> </ul>"},{"location":"SHEET_QUERY_SYSTEM/","title":"SheetQuery System Documentation","text":"<p>Comprehensive information sheets query system for MicroGrowAgents</p>"},{"location":"SHEET_QUERY_SYSTEM/#overview","title":"Overview","text":"<p>The SheetQuery system provides powerful querying capabilities for topic-specific extended data collections stored in <code>data/sheets_*</code> directories. It enables querying TSV files and full-text publication markdown files with evidence-rich reporting.</p>"},{"location":"SHEET_QUERY_SYSTEM/#features","title":"Features","text":""},{"location":"SHEET_QUERY_SYSTEM/#4-query-types","title":"4 Query Types","text":"<ol> <li>Entity Lookup: Find entities by ID, name, or type</li> <li>Cross-Reference: Find related entities across tables and publications</li> <li>Publication Search: Full-text search within markdown publications</li> <li>Filtered Queries: SQL-like filtering on any table</li> </ol>"},{"location":"SHEET_QUERY_SYSTEM/#3-output-formats","title":"3 Output Formats","text":"<ol> <li>Markdown Tables: Formatted tables with DOI/PMID citation links</li> <li>JSON: Clean structured data for programmatic use</li> <li>Evidence Reports: Detailed reports with publication excerpts</li> </ol>"},{"location":"SHEET_QUERY_SYSTEM/#database-schema","title":"Database Schema","text":"<ul> <li>5 tables: <code>sheet_collections</code>, <code>sheet_tables</code>, <code>sheet_data</code>, <code>sheet_publications</code>, <code>sheet_publication_references</code></li> <li>9 strategic indexes: Optimized for all query types</li> <li>EAV pattern: Flexible JSON storage for variable schemas</li> <li>Auto-increment IDs: Using DuckDB sequences</li> </ul>"},{"location":"SHEET_QUERY_SYSTEM/#quick-start","title":"Quick Start","text":""},{"location":"SHEET_QUERY_SYSTEM/#1-initialize-schema","title":"1. Initialize Schema","text":"<pre><code># Schema is automatically created when loading data\nuv run python scripts/init_sheet_schema.py --database data/processed/microgrow.duckdb\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#2-load-data","title":"2. Load Data","text":"<pre><code># Load CMM collection\nuv run python scripts/load_sheets.py \\\n    --collection-id cmm \\\n    --sheets-dir data/sheets_cmm \\\n    --validate\n\n# Expected output:\n# Tables Loaded: 17\n# Publications: 118\n# Total Rows: 1,763\n# References Created: 200+\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#3-query-data","title":"3. Query Data","text":""},{"location":"SHEET_QUERY_SYSTEM/#python-api-agent","title":"Python API (Agent)","text":"<pre><code>from microgrowagents.agents.sheet_query_agent import SheetQueryAgent\n\nagent = SheetQueryAgent()\n\n# Entity lookup\nresult = agent.entity_lookup(\n    query=\"lookup europium\",\n    collection_id=\"cmm\",\n    entity_id=\"CHEBI:52927\"\n)\n\n# Cross-reference\nresult = agent.cross_reference_query(\n    query=\"find genes related to europium\",\n    collection_id=\"cmm\",\n    source_entity_id=\"CHEBI:52927\",\n    include_types=[\"gene\"]\n)\n\n# Publication search\nresult = agent.publication_search(\n    query=\"search for lanthanide studies\",\n    collection_id=\"cmm\",\n    keyword=\"lanthanide\",\n    include_excerpts=True\n)\n\n# Filtered query\nresult = agent.filtered_query(\n    query=\"filter chemicals by formula\",\n    collection_id=\"cmm\",\n    table_name=\"chemicals\",\n    filter_conditions={\"molecular_formula\": \"Eu3+\"}\n)\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#python-api-skill","title":"Python API (Skill)","text":"<pre><code>from microgrowagents.skills.simple.sheet_query import SheetQuerySkill\n\nskill = SheetQuerySkill()\n\n# Markdown output\nresult = skill.run(\n    collection_id=\"cmm\",\n    query_type=\"entity_lookup\",\n    entity_id=\"CHEBI:52927\",\n    output_format=\"markdown\"\n)\nprint(result)\n\n# JSON output\nresult = skill.run(\n    collection_id=\"cmm\",\n    query_type=\"publication_search\",\n    keyword=\"europium\",\n    output_format=\"json\"\n)\nimport json\ndata = json.loads(result)\n\n# Evidence report\nresult = skill.run(\n    collection_id=\"cmm\",\n    query_type=\"cross_reference\",\n    source_entity_id=\"K23995\",\n    output_format=\"evidence_report\"\n)\nprint(result)\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#architecture","title":"Architecture","text":""},{"location":"SHEET_QUERY_SYSTEM/#component-overview","title":"Component Overview","text":"<pre><code>SheetQuery System\n\u251c\u2500\u2500 Database Layer\n\u2502   \u251c\u2500\u2500 schema.py           # 5 tables + 9 indexes\n\u2502   \u251c\u2500\u2500 sheet_loader.py     # TSV + publication loading (661 lines)\n\u2502   \u2514\u2500\u2500 init_sheet_schema.py # Schema initialization script\n\u2502\n\u251c\u2500\u2500 Agent Layer\n\u2502   \u2514\u2500\u2500 sheet_query_agent.py  # 4 query types (655 lines)\n\u2502\n\u251c\u2500\u2500 Skill Layer\n\u2502   \u2514\u2500\u2500 sheet_query.py        # 3 output formatters (541 lines)\n\u2502\n\u2514\u2500\u2500 Scripts\n    \u2514\u2500\u2500 load_sheets.py        # Data loading script (157 lines)\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#data-flow","title":"Data Flow","text":"<pre><code>1. Loading:\n   TSV Files + Publications \u2192 SheetDataLoader \u2192 DuckDB (5 tables)\n\n2. Querying:\n   User Query \u2192 SheetQuerySkill \u2192 SheetQueryAgent \u2192 DuckDB\n              \u2192 Format (MD/JSON/Report) \u2192 User\n\n3. Cross-References:\n   Entity \u2192 extract FK IDs \u2192 match publications \u2192 link via sheet_publication_references\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#database-schema-details","title":"Database Schema Details","text":""},{"location":"SHEET_QUERY_SYSTEM/#table-1-sheet_collections","title":"Table 1: sheet_collections","text":"<p>Collection metadata registry</p> <pre><code>collection_id VARCHAR PRIMARY KEY    -- 'cmm', 'xyz'\ncollection_name VARCHAR NOT NULL     -- 'CMM Extended Data'\ndirectory_path VARCHAR NOT NULL      -- 'data/sheets_cmm'\nloaded_at TIMESTAMP\ntable_count INTEGER\ntotal_rows INTEGER\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#table-2-sheet_tables","title":"Table 2: sheet_tables","text":"<p>Table registry for each collection</p> <pre><code>table_id VARCHAR PRIMARY KEY         -- 'cmm_chemicals'\ncollection_id VARCHAR NOT NULL       -- FK to sheet_collections\ntable_name VARCHAR NOT NULL          -- 'chemicals'\nsource_file VARCHAR NOT NULL         -- 'BER_CMM_..._chemicals_extended.tsv'\nrow_count INTEGER\ncolumn_count INTEGER\ncolumns_json TEXT                    -- JSON array of column names\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#table-3-sheet_data","title":"Table 3: sheet_data","text":"<p>Unified entity storage (EAV pattern)</p> <pre><code>id INTEGER PRIMARY KEY              -- Auto-increment via sequence\ntable_id VARCHAR NOT NULL           -- FK to sheet_tables\nentity_id VARCHAR                   -- Primary ID (CHEBI:52927, K23995, etc.)\nentity_name VARCHAR                 -- Primary name\nentity_type VARCHAR                 -- 'chemical', 'gene', 'strain', etc.\ndata_json TEXT NOT NULL             -- Complete row as JSON\nsearchable_text TEXT                -- Concatenated text for full-text search\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#table-4-sheet_publications","title":"Table 4: sheet_publications","text":"<p>Publication full-text index</p> <pre><code>id INTEGER PRIMARY KEY              -- Auto-increment\ncollection_id VARCHAR NOT NULL      -- FK to sheet_collections\nfile_name VARCHAR NOT NULL          -- 'PMID_24816778.md'\npublication_id VARCHAR              -- 'pmid:24816778', 'doi:10.1038/...'\npublication_type VARCHAR            -- 'pmid', 'doi', 'pmc'\ntitle TEXT\nfull_text TEXT                      -- Complete markdown content\nword_count INTEGER\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#table-5-sheet_publication_references","title":"Table 5: sheet_publication_references","text":"<p>Cross-references between entities and publications</p> <pre><code>id INTEGER PRIMARY KEY              -- Auto-increment\npublication_id INTEGER NOT NULL     -- FK to sheet_publications.id\ntable_id VARCHAR NOT NULL           -- FK to sheet_tables\nentity_id VARCHAR NOT NULL          -- Entity referencing publication\nreference_column VARCHAR            -- Column where reference appears (URL, DOI)\nreference_value VARCHAR             -- Actual reference value\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#indexes-9-total","title":"Indexes (9 total)","text":"<p>Entity Lookup (Query Type 1): - <code>idx_sheet_data_entity_id</code> - Fast ID lookups - <code>idx_sheet_data_entity_name</code> - Name-based searches - <code>idx_sheet_data_entity_type</code> - Type filtering</p> <p>Cross-Reference (Query Type 2): - <code>idx_sheet_data_composite</code> - (table_id, entity_type) compound index - <code>idx_sheet_pub_refs_entity</code> - Entity\u2192Publication links</p> <p>Publication Search (Query Type 3): - <code>idx_sheet_pubs_pub_id</code> - Publication ID lookups - <code>idx_sheet_data_searchable</code> - Full-text search</p> <p>Filtered Queries (Query Type 4): - <code>idx_sheet_tables_collection</code> - Collection-based filtering - <code>idx_sheet_data_table</code> - Table-based filtering</p>"},{"location":"SHEET_QUERY_SYSTEM/#query-types-in-detail","title":"Query Types in Detail","text":""},{"location":"SHEET_QUERY_SYSTEM/#1-entity-lookup","title":"1. Entity Lookup","text":"<p>Purpose: Find entities by ID, name, or type</p> <p>Parameters: - <code>collection_id</code> (required): Collection to search - <code>entity_id</code> (optional): Exact ID match - <code>entity_name</code> (optional): Name match (exact or partial) - <code>entity_type</code> (optional): Filter by type - <code>exact_match</code> (optional): Boolean for partial name matching</p> <p>Example:</p> <pre><code># By ID\nresult = agent.entity_lookup(\n    query=\"lookup\",\n    collection_id=\"cmm\",\n    entity_id=\"CHEBI:52927\"\n)\n\n# By name (partial)\nresult = agent.entity_lookup(\n    query=\"find lanthanide\",\n    collection_id=\"cmm\",\n    entity_name=\"lanthanide\",\n    exact_match=False\n)\n\n# By type\nresult = agent.entity_lookup(\n    query=\"all chemicals\",\n    collection_id=\"cmm\",\n    entity_type=\"chemical\"\n)\n</code></pre> <p>Returns:</p> <pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"entities\": [{\n      \"entity_id\": \"CHEBI:52927\",\n      \"entity_name\": \"Europium(III) cation\",\n      \"entity_type\": \"chemical\",\n      \"properties\": {\n        \"chemical_id\": \"CHEBI:52927\",\n        \"molecular_formula\": \"Eu3+\",\n        \"molecular_weight\": \"151.964\",\n        \"role\": \"TRL probe\"\n      }\n    }]\n  }\n}\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#2-cross-reference-query","title":"2. Cross-Reference Query","text":"<p>Purpose: Find entities related to a source entity and its publications</p> <p>Strategy: 1. Retrieve source entity 2. Extract foreign key IDs from data_json (CHEBI, GO, KEGG, etc.) 3. Find entities with matching IDs 4. Search for entities referencing the source 5. Retrieve linked publications</p> <p>Parameters: - <code>collection_id</code> (required) - <code>source_entity_id</code> (required) - <code>include_types</code> (optional): Filter related entities by type</p> <p>Example:</p> <pre><code>result = agent.cross_reference_query(\n    query=\"find entities related to XoxF\",\n    collection_id=\"cmm\",\n    source_entity_id=\"K23995\",\n    include_types=[\"chemical\", \"pathway\"]\n)\n</code></pre> <p>Returns:</p> <pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"source_entity\": {\n      \"entity_id\": \"K23995\",\n      \"entity_name\": \"XoxF methanol dehydrogenase\",\n      \"entity_type\": \"gene\"\n    },\n    \"related_entities\": [\n      {\n        \"entity_id\": \"CHEBI:52927\",\n        \"entity_name\": \"Europium(III) cation\",\n        \"entity_type\": \"chemical\",\n        \"relationship\": \"referenced_by_source\"\n      }\n    ],\n    \"publications\": [\n      {\n        \"publication_id\": \"pmid:24816778\",\n        \"publication_type\": \"pmid\",\n        \"title\": \"Chemistry of Lanthanides...\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#3-publication-search","title":"3. Publication Search","text":"<p>Purpose: Full-text search within publication markdown files</p> <p>Parameters: - <code>collection_id</code> (required) - <code>keyword</code> or <code>keywords</code> (required): Search term(s) - <code>max_results</code> (optional): Limit results (default: 50) - <code>include_excerpts</code> (optional): Include text excerpts (default: True)</p> <p>Example:</p> <pre><code>result = agent.publication_search(\n    query=\"search for europium studies\",\n    collection_id=\"cmm\",\n    keyword=\"europium\",\n    include_excerpts=True,\n    max_results=10\n)\n</code></pre> <p>Returns:</p> <pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"publications\": [\n      {\n        \"publication_id\": \"pmid:24816778\",\n        \"publication_type\": \"pmid\",\n        \"full_text\": \"...\",\n        \"excerpt\": \"...lanthanides such as **europium** have emerged...\",\n        \"entity_count\": 5\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#4-filtered-query","title":"4. Filtered Query","text":"<p>Purpose: SQL-like filtering on tables with JSON path extraction</p> <p>Supported Operators: - Equality: <code>{\"property\": \"value\"}</code> - Contains: <code>{\"property\": {\"$contains\": \"substring\"}}</code></p> <p>Parameters: - <code>collection_id</code> (required) - <code>table_name</code> (optional): Specific table to filter - <code>entity_type</code> (optional): Filter by entity type - <code>filter_conditions</code> (optional): Dict of property filters</p> <p>Example:</p> <pre><code># Simple equality\nresult = agent.filtered_query(\n    query=\"filter by formula\",\n    collection_id=\"cmm\",\n    table_name=\"chemicals\",\n    filter_conditions={\"molecular_formula\": \"Eu3+\"}\n)\n\n# Contains operator\nresult = agent.filtered_query(\n    query=\"filter genes\",\n    collection_id=\"cmm\",\n    table_name=\"genes_and_proteins\",\n    filter_conditions={\n        \"annotation\": {\"$contains\": \"dehydrogenase\"}\n    }\n)\n\n# Multiple conditions (AND logic)\nresult = agent.filtered_query(\n    query=\"filter\",\n    collection_id=\"cmm\",\n    table_name=\"genes_and_proteins\",\n    filter_conditions={\n        \"organism\": \"NCBITaxon:469\",\n        \"annotation\": {\"$contains\": \"methanol\"}\n    }\n)\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#output-formats","title":"Output Formats","text":""},{"location":"SHEET_QUERY_SYSTEM/#1-markdown-tables","title":"1. Markdown Tables","text":"<p>Best for: Human-readable reports, documentation</p> <p>Features: - Formatted tables with pipe delimiters - Clickable DOI/PMID citation links - Limited to 50 entities per table for readability - Includes section headers</p> <p>Example:</p> <pre><code># Sheet Query Results: cmm\n\n## Entities (5 found)\n\n| ID | Name | Type | Properties |\n|----|------|------|------------|\n| CHEBI:52927 | Europium(III) cation | chemical | formula: Eu3+, MW: 151.964 |\n\n## Publications (2 found)\n\n### 1. [PMID:24816778](https://pubmed.ncbi.nlm.nih.gov/24816778/)\n\n**Excerpt**: ...lanthanides such as **europium** have emerged...\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#2-json","title":"2. JSON","text":"<p>Best for: Programmatic access, data pipelines</p> <p>Features: - Valid JSON with full data structures - Includes execution metadata - No data truncation</p> <p>Example:</p> <pre><code>{\n  \"success\": true,\n  \"data\": {\n    \"entities\": [\n      {\n        \"entity_id\": \"CHEBI:52927\",\n        \"entity_name\": \"Europium(III) cation\",\n        \"entity_type\": \"chemical\",\n        \"properties\": {\n          \"chemical_id\": \"CHEBI:52927\",\n          \"molecular_formula\": \"Eu3+\",\n          \"molecular_weight\": \"151.964\"\n        }\n      }\n    ],\n    \"count\": 1\n  },\n  \"metadata\": {\n    \"query\": \"lookup chemical\",\n    \"collection_id\": \"cmm\",\n    \"execution_time\": 0.05\n  }\n}\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#3-evidence-reports","title":"3. Evidence Reports","text":"<p>Best for: Detailed analysis, research reports</p> <p>Features: - Comprehensive entity details - Grouped related entities by type - Publication excerpts with context - Structured sections with headers - Publication links</p> <p>Example:</p> <pre><code># Evidence Report: cmm\n\n## Entity Details\n\n**Chemical**: Europium(III) cation\n\n**ID**: CHEBI:52927\n\n### Properties\n\n- **molecular_formula**: Eu3+\n- **molecular_weight**: 151.964\n- **role**: TRL assay probe\n\n## Related Entities (3)\n\n### Genes (2)\n\n- **K23995**: XoxF methanol dehydrogenase\n  - *referenced_by_source*\n- **custom_xoxF_ma**: Lanthanide-dependent methanol dehydrogenase\n\n## Publication Evidence\n\n### 1. PMID:24816778\n\n[View on PubMed](https://pubmed.ncbi.nlm.nih.gov/24816778/)\n\n&gt; Lanthanides such as **europium** and **terbium** have emerged\n&gt; as essential cofactors for bacterial enzymes involved in\n&gt; methanol metabolism...\n\n**Referenced by**: 5 entities in this collection\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#testing","title":"Testing","text":""},{"location":"SHEET_QUERY_SYSTEM/#test-coverage-9191-tests-passing-100","title":"Test Coverage: 91/91 tests passing (100%)","text":"<p>Schema Tests (8 tests): - Table creation - Index creation - Data insertion - Constraint validation</p> <p>Loader Tests (20 tests): - TSV loading - Publication loading - Entity type inference - Publication ID extraction - Cross-reference building - Error handling</p> <p>Agent Tests (27 tests): - Entity lookup (7 tests) - Cross-reference (3 tests) - Publication search (5 tests) - Filtered queries (5 tests) - Query routing (5 tests) - Error handling (2 tests)</p> <p>Skill Tests (22 tests): - Markdown output (3 tests) - JSON output (3 tests) - Evidence reports (3 tests) - All query types (4 tests) - Parameter validation (3 tests) - Output switching (1 test)</p> <p>Integration Tests (14 tests): - End-to-end workflow - Data integrity - Publication citations - Multiple collections - Query performance - Error recovery - Output formats - Data validation</p>"},{"location":"SHEET_QUERY_SYSTEM/#running-tests","title":"Running Tests","text":"<pre><code># All SheetQuery tests\nuv run pytest tests/test_database/test_sheet_schema.py \\\n             tests/test_database/test_sheet_loader.py \\\n             tests/test_agents/test_sheet_query_agent.py \\\n             tests/test_skills/test_sheet_query_skill.py \\\n             tests/integration/test_sheet_query_integration.py -v\n\n# Specific test categories\nuv run pytest tests/test_database/test_sheet_loader.py -v  # Loader only\nuv run pytest tests/test_agents/test_sheet_query_agent.py -v  # Agent only\nuv run pytest tests/integration/ -v  # Integration only\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#performance","title":"Performance","text":""},{"location":"SHEET_QUERY_SYSTEM/#query-performance-benchmarks","title":"Query Performance Benchmarks","text":"<p>Entity Lookup by ID: &lt; 100ms (indexed) Cross-Reference Query: &lt; 500ms Publication Search: &lt; 1 second Filtered Query: &lt; 200ms</p>"},{"location":"SHEET_QUERY_SYSTEM/#loading-performance","title":"Loading Performance","text":"<p>CMM Collection (17 TSV + 118 publications): - Loading time: ~30 seconds - Total rows: 1,763 - Database size: ~15 MB</p>"},{"location":"SHEET_QUERY_SYSTEM/#optimization-features","title":"Optimization Features","text":"<ol> <li>Strategic Indexes: 9 indexes optimized for specific query patterns</li> <li>Batch Inserts: 1000 rows per INSERT during loading</li> <li>JSON Storage: Flexible schema without complex migrations</li> <li>Connection Pooling: Reuse database connections</li> </ol>"},{"location":"SHEET_QUERY_SYSTEM/#troubleshooting","title":"Troubleshooting","text":""},{"location":"SHEET_QUERY_SYSTEM/#common-issues","title":"Common Issues","text":"<p>Issue: \"Table does not exist\" error Solution: Run <code>scripts/init_sheet_schema.py</code> or load data with <code>--validate</code> flag</p> <p>Issue: \"Collection not found\" Solution: Verify collection_id matches loaded collection name</p> <p>Issue: \"Slow queries\" Solution: Ensure indexes exist (<code>SHOW INDEXES</code> in DuckDB)</p> <p>Issue: \"Connection error\" Solution: Ensure no stale connections; loader auto-closes after operations</p>"},{"location":"SHEET_QUERY_SYSTEM/#debugging","title":"Debugging","text":"<pre><code># Enable debug logging\nimport logging\nlogging.basicConfig(level=logging.DEBUG)\n\n# Check loaded collections\nconn = duckdb.connect(\"data/processed/microgrow.duckdb\")\nconn.execute(\"SELECT * FROM sheet_collections\").fetchall()\n\n# Check table counts\nconn.execute(\"\"\"\n    SELECT collection_id, table_name, row_count\n    FROM sheet_tables\n    ORDER BY collection_id, table_name\n\"\"\").fetchall()\n\n# Check indexes\nconn.execute(\"SHOW INDEXES\").fetchall()\n</code></pre>"},{"location":"SHEET_QUERY_SYSTEM/#future-enhancements","title":"Future Enhancements","text":"<p>Potential improvements: 1. Query Language: Natural language query parsing 2. Advanced Filters: Greater-than, less-than, IN operators 3. Aggregations: COUNT, GROUP BY on entity properties 4. Export: Direct export to CSV, Excel, PDF 5. Caching: Query result caching for frequent searches 6. Fuzzy Search: Approximate string matching for entity names</p>"},{"location":"SHEET_QUERY_SYSTEM/#license","title":"License","text":"<p>Part of MicroGrowAgents project.</p>"},{"location":"SHEET_QUERY_SYSTEM/#support","title":"Support","text":"<p>For issues or questions: - GitHub Issues: https://github.com/monarch-initiative/MicroGrowAgents/issues - Documentation: <code>docs/</code></p>"},{"location":"about/","title":"About MicroGrowAgents","text":"<p>Agent-based system for microbial growth predictions</p>"},{"location":"cofactor_curation_methodology/","title":"Cofactor Curation Methodology","text":"<p>This document describes the detailed methodology used to create and maintain the cofactor reference data for the MicroGrowAgents system.</p>"},{"location":"cofactor_curation_methodology/#overview","title":"Overview","text":"<p>The cofactor curation process integrates data from multiple authoritative biological databases into structured reference files that power the CofactorMediaAgent. The methodology emphasizes:</p> <ol> <li>Multi-source validation: Cross-referencing across ChEBI, KEGG, BRENDA, and ExplorEnz</li> <li>Literature-based curation: Specialized cofactors validated against primary literature</li> <li>Pattern-based mapping: Scalable EC-to-cofactor relationships using wildcards</li> <li>Reproducibility: All curation steps documented with version control</li> </ol>"},{"location":"cofactor_curation_methodology/#1-cofactor-hierarchy-curation","title":"1. Cofactor Hierarchy Curation","text":""},{"location":"cofactor_curation_methodology/#file-cofactor_hierarchyyaml","title":"File: <code>cofactor_hierarchy.yaml</code>","text":""},{"location":"cofactor_curation_methodology/#step-1-initial-cofactor-identification","title":"Step 1: Initial Cofactor Identification","text":"<p>Data Sources: - ChEBI ontology search for term \"cofactor\" (CHEBI:23357) - KEGG compound search for \"coenzyme\" and \"prosthetic group\" - Literature review for specialized cofactors (lanthanides, PQQ, archaeal cofactors)</p> <p>Inclusion Criteria: - Essential for enzyme catalysis or electron transfer - Chemically well-defined structure - Present in at least one known microbial enzyme - Has a ChEBI ID or KEGG compound ID</p> <p>Exclusion Criteria: - Generic terms (e.g., \"organic cofactor\") - Insufficiently characterized compounds - Eukaryote-specific cofactors not found in bacteria/archaea</p>"},{"location":"cofactor_curation_methodology/#step-2-functional-categorization","title":"Step 2: Functional Categorization","text":"<p>Categories defined: 1. Vitamins - Organic cofactors derived from dietary vitamins 2. Metals - Metal ions and metalloenzyme prosthetic groups 3. Nucleotides - Nucleotide-based redox carriers and energy currencies 4. Energy Cofactors - Group transfer and energy metabolism cofactors 5. Other - Specialized cofactors (PQQ, archaeal cofactors, etc.)</p> <p>Categorization Process:</p> <pre><code># Pseudo-algorithm\nfor cofactor in candidate_list:\n    if has_vitamin_precursor(cofactor):\n        category = \"vitamins\"\n    elif contains_metal(cofactor):\n        category = \"metals\"\n    elif is_nucleotide_derivative(cofactor):\n        category = \"nucleotides\"\n    elif is_group_transfer_cofactor(cofactor):\n        category = \"energy_cofactors\"\n    else:\n        category = \"other\"\n</code></pre>"},{"location":"cofactor_curation_methodology/#step-3-chebi-id-assignment","title":"Step 3: ChEBI ID Assignment","text":"<p>Process: 1. Search ChEBI ontology by cofactor name 2. Verify chemical structure matches expected cofactor 3. Select most specific ChEBI ID (e.g., CHEBI:15846 for NAD+ vs CHEBI:13389 for NAD) 4. Record primary ID and all synonyms</p> <p>ChEBI Search Tool: https://www.ebi.ac.uk/chebi/advancedSearchFT.do</p> <p>Example:</p> <pre><code>thiamine_pyrophosphate:\n  id: \"CHEBI:9532\"  # Exact match from ChEBI search\n  names: [\"TPP\", \"ThDP\", \"Thiamine diphosphate\"]  # All synonyms\n</code></pre>"},{"location":"cofactor_curation_methodology/#step-4-kegg-pathway-mapping","title":"Step 4: KEGG Pathway Mapping","text":"<p>Process: 1. Search KEGG pathway database for cofactor biosynthesis 2. Record pathway IDs (ko##### format) 3. Validate pathway relevance to bacterial/archaeal metabolism</p> <p>KEGG Resources: - Pathway database: https://www.genome.jp/kegg/pathway.html - Compound database: https://www.genome.jp/kegg/compound/</p> <p>Example Pathways: - ko00730: Thiamine metabolism (for TPP) - ko00760: Nicotinate and nicotinamide metabolism (for NAD/NADP) - ko00780: Biotin metabolism</p>"},{"location":"cofactor_curation_methodology/#step-5-ec-association-assignment","title":"Step 5: EC Association Assignment","text":"<p>Process: 1. Query BRENDA for enzymes requiring specific cofactor 2. Extract EC numbers from enzyme entries 3. Generalize to EC patterns where appropriate 4. Validate against ExplorEnz classifications</p> <p>Example:</p> <pre><code>pyridoxal_phosphate:\n  ec_associations: [\"2.6.1.-\", \"4.1.1.-\", \"5.1.1.-\"]  # All aminotransferases, decarboxylases, racemases\n</code></pre>"},{"location":"cofactor_curation_methodology/#step-6-quality-control","title":"Step 6: Quality Control","text":"<p>Validation Checks: - [ ] All cofactors have valid ChEBI IDs - [ ] All synonyms verified against ChEBI - [ ] KEGG pathway IDs are valid - [ ] EC associations match BRENDA/ExplorEnz - [ ] No duplicate cofactor entries - [ ] All categories properly defined</p>"},{"location":"cofactor_curation_methodology/#2-ec-to-cofactor-mapping","title":"2. EC-to-Cofactor Mapping","text":""},{"location":"cofactor_curation_methodology/#file-ec_to_cofactor_mapyaml","title":"File: <code>ec_to_cofactor_map.yaml</code>","text":""},{"location":"cofactor_curation_methodology/#step-1-brenda-data-mining","title":"Step 1: BRENDA Data Mining","text":"<p>Process: 1. For each EC class (1-6), query BRENDA for cofactor requirements 2. Extract cofactor-EC relationships from enzyme entries 3. Identify patterns across EC subclasses</p> <p>BRENDA Query Example:</p> <pre><code>EC 1.1.1.- (NAD/NADP-dependent dehydrogenases)\n\u2192 Primary: NAD+, NADP+\n\u2192 Optional: Zn2+ (for some alcohol dehydrogenases)\n</code></pre>"},{"location":"cofactor_curation_methodology/#step-2-pattern-generalization","title":"Step 2: Pattern Generalization","text":"<p>Pattern Hierarchy: 1. Exact match (highest priority): <code>\"1.1.1.27\"</code> - specific enzyme 2. 3-digit pattern: <code>\"1.1.1.-\"</code> - EC subclass 3. 2-digit pattern: <code>\"1.1.-.-\"</code> - EC sub-subclass (rarely used) 4. 1-digit pattern: Never used (too broad)</p> <p>Generalization Rules: - If &gt;80% of enzymes in EC subclass share cofactor \u2192 create pattern - If cofactor is optional in &lt;50% of enzymes \u2192 mark as \"optional\" - If conflicting evidence \u2192 use exact EC number</p>"},{"location":"cofactor_curation_methodology/#step-3-primary-vs-optional-classification","title":"Step 3: Primary vs Optional Classification","text":"<p>Definitions: - Primary: Absolutely required for catalytic activity - Optional: Enhances activity or is alternative substrate</p> <p>Classification Process:</p> <pre><code>\"1.1.1.-\":\n  primary: [\"nad\", \"nadp\"]     # Required for all dehydrogenases\n  optional: [\"zinc_ion\"]       # Only for alcohol dehydrogenases\n</code></pre>"},{"location":"cofactor_curation_methodology/#step-4-cross-validation-with-metacyc","title":"Step 4: Cross-Validation with MetaCyc","text":"<p>Process: 1. Query MetaCyc for EC number 2. Verify cofactor requirements match BRENDA 3. Resolve conflicts by checking primary literature</p>"},{"location":"cofactor_curation_methodology/#step-5-quality-control","title":"Step 5: Quality Control","text":"<p>Validation Checks: - [ ] All EC patterns are valid (e.g., \"1.1.1.-\" not \"1.1.1\") - [ ] No conflicting mappings (same EC \u2192 different cofactors) - [ ] All cofactor keys reference <code>cofactor_hierarchy.yaml</code> entries - [ ] Pattern hierarchy respected (exact &gt; 3-digit &gt; 2-digit) - [ ] Primary/optional classification justified</p>"},{"location":"cofactor_curation_methodology/#3-ingredient-to-cofactor-mapping","title":"3. Ingredient-to-Cofactor Mapping","text":""},{"location":"cofactor_curation_methodology/#file-ingredient_cofactor_mappingcsv","title":"File: <code>ingredient_cofactor_mapping.csv</code>","text":""},{"location":"cofactor_curation_methodology/#data-source","title":"Data Source","text":"<p>Input: <code>data/raw/mp_medium_ingredient_properties.csv</code> (158 ingredients)</p>"},{"location":"cofactor_curation_methodology/#mapping-algorithm","title":"Mapping Algorithm","text":"<p>Script: <code>scripts/generate_ingredient_cofactor_mapping.py</code></p> <p>Step 1: Component Name Parsing</p> <pre><code>def extract_cofactor_from_component(component_name, chebi_id):\n    \"\"\"\n    Rule-based pattern matching on component names.\n\n    Examples:\n    - \"Thiamin\" \u2192 thiamine_pyrophosphate\n    - \"FeSO\u2084\u00b77H\u2082O\" \u2192 iron_ion, heme, iron_sulfur_clusters\n    - \"MgCl\u2082\u00b76H\u2082O\" \u2192 magnesium_ion\n    \"\"\"\n    cofactors = []\n\n    # Vitamin mappings\n    if \"thiamin\" in component_name.lower():\n        cofactors.append(\"thiamine_pyrophosphate\")\n    elif \"biotin\" in component_name.lower():\n        cofactors.append(\"biotin\")\n    elif \"cobal\" in component_name.lower():  # Cobalamin, cobalt\n        cofactors.extend([\"cobalamin\", \"cobalt_ion\"])\n\n    # Metal mappings (extract from chemical formula)\n    if extract_metal(component_name) == \"Mg\":\n        cofactors.append(\"magnesium_ion\")\n    elif extract_metal(component_name) == \"Fe\":\n        cofactors.extend([\"iron_ion\", \"heme\", \"iron_sulfur_clusters\"])\n    elif extract_metal(component_name) == \"Zn\":\n        cofactors.append(\"zinc_ion\")\n    # ... etc for all metals\n\n    return cofactors\n</code></pre> <p>Step 2: ChEBI ID Validation - Verify ChEBI ID from source CSV matches expected chemical - Cross-check with ChEBI ontology using <code>chebi_client.py</code></p> <p>Step 3: Manual Curation - Review edge cases (e.g., rare earth elements \u2192 lanthanides) - Add lanthanide mapping for NdCl\u2083, PrCl\u2083, etc. - Verify multi-cofactor assignments (e.g., Fe \u2192 iron_ion + heme + Fe-S)</p>"},{"location":"cofactor_curation_methodology/#quality-control","title":"Quality Control","text":"<p>Validation Checks: - [ ] All ingredient names from MP medium CSV present - [ ] ChEBI IDs match source data - [ ] Cofactor keys reference <code>cofactor_hierarchy.yaml</code> - [ ] No missing cofactor assignments for known cofactor-providing ingredients - [ ] Multi-cofactor assignments justified (e.g., Fe provides multiple forms)</p>"},{"location":"cofactor_curation_methodology/#4-integration-testing","title":"4. Integration Testing","text":""},{"location":"cofactor_curation_methodology/#test-organisms","title":"Test Organisms","text":"<p>E. coli K-12: Well-characterized model organism - Expected cofactors: NAD, FAD, CoA, Fe, Mg, etc. - Biosynthesis: Capable for most vitamins - Validation: Compare to EcoCyc pathways</p> <p>M. radiotolerans: Methylotroph representative - Expected cofactors: PQQ, lanthanides (XoxF-MDH) - Validation: Compare to published genome analysis</p>"},{"location":"cofactor_curation_methodology/#test-cases","title":"Test Cases","text":"<p>Test 1: Cofactor Identification</p> <pre><code>def test_cofactor_identification():\n    \"\"\"Test that all expected cofactors are identified from genome.\"\"\"\n    agent = CofactorMediaAgent()\n    result = agent.analyze_cofactor_requirements(\"SAMN02604091\")  # E. coli\n\n    expected_cofactors = [\"nad\", \"fad\", \"thiamine_pyrophosphate\", \"iron_ion\"]\n    found_cofactors = [req.cofactor_key for req in result]\n\n    assert all(cf in found_cofactors for cf in expected_cofactors)\n</code></pre> <p>Test 2: Ingredient Mapping</p> <pre><code>def test_ingredient_mapping():\n    \"\"\"Test that MP medium ingredients map to cofactors.\"\"\"\n    agent = CofactorMediaAgent()\n    requirements = [\n        CofactorRequirement(cofactor_key=\"magnesium_ion\", ...)\n    ]\n\n    mapping = agent.map_ingredients_to_cofactors(requirements, \"MP\")\n\n    # Mg should be mapped to MgCl\u2082\u00b76H\u2082O\n    assert any(\"MgCl\" in ing.ingredient_name for ing in mapping[\"existing\"])\n</code></pre> <p>Test 3: Cross-Validation with Literature</p> <pre><code>def test_literature_validation():\n    \"\"\"Validate lanthanide cofactor for M. extorquens.\"\"\"\n    agent = CofactorMediaAgent()\n    result = agent.analyze_cofactor_requirements(\"Methylobacterium_extorquens\")\n\n    # Should detect lanthanide requirement for XoxF\n    cofactors = [req.cofactor_key for req in result]\n    assert \"lanthanides\" in cofactors\n</code></pre>"},{"location":"cofactor_curation_methodology/#5-version-control-and-updates","title":"5. Version Control and Updates","text":""},{"location":"cofactor_curation_methodology/#versioning-strategy","title":"Versioning Strategy","text":"<p>Version Format: <code>MAJOR.MINOR</code> (e.g., 1.0, 1.1, 2.0)</p> <p>Version Increments: - MAJOR: Breaking changes (e.g., restructure categories, change keys) - MINOR: Additions (e.g., new cofactors, new EC mappings)</p> <p>Current Version: 1.0 (as of 2025-01-10)</p>"},{"location":"cofactor_curation_methodology/#update-procedure","title":"Update Procedure","text":"<p>Adding New Cofactor: 1. Verify ChEBI ID exists 2. Assign to appropriate category 3. Map EC associations from BRENDA 4. Identify KEGG biosynthesis pathway 5. Update <code>cofactor_hierarchy.yaml</code> 6. Run tests to verify integration 7. Increment MINOR version</p> <p>Adding New EC Mapping: 1. Query BRENDA for EC number 2. Identify cofactor requirements 3. Determine if pattern or exact match 4. Update <code>ec_to_cofactor_map.yaml</code> 5. Run tests 6. Increment MINOR version</p> <p>Citation Updates: - Review annually for database updates (ChEBI, KEGG, BRENDA) - Update DOIs if new papers published - Maintain backward compatibility with existing ChEBI IDs</p>"},{"location":"cofactor_curation_methodology/#6-future-enhancements","title":"6. Future Enhancements","text":""},{"location":"cofactor_curation_methodology/#planned-improvements","title":"Planned Improvements","text":"<ol> <li>Automated ChEBI ID Validation</li> <li>Script to check all ChEBI IDs are still valid</li> <li> <p>Detect deprecated IDs and suggest replacements</p> </li> <li> <p>BRENDA API Integration</p> </li> <li>Automate EC-to-cofactor mapping updates</li> <li> <p>Quarterly refresh of cofactor-enzyme relationships</p> </li> <li> <p>Quantitative Cofactor Requirements</p> </li> <li>Add stoichiometry information (e.g., 2 Mg2+ per enzyme)</li> <li> <p>Concentration ranges for optimal activity</p> </li> <li> <p>Organism-Specific Cofactor Variants</p> </li> <li>Expand lanthanide mapping (La, Ce, Nd, Pr, Dy specificities)</li> <li>Quinone pool variations (ubiquinone vs menaquinone preferences)</li> </ol>"},{"location":"cofactor_curation_methodology/#7-citation-management","title":"7. Citation Management","text":""},{"location":"cofactor_curation_methodology/#citation-update-process","title":"Citation Update Process","text":"<p>Annual Review (recommended: January each year): 1. Check for updated versions of ChEBI, KEGG, BRENDA 2. Update DOIs in YAML headers 3. Verify URL accessibility 4. Update BibTeX file (<code>docs/references/cofactor_sources.bib</code>)</p> <p>Adding New Citations: 1. Add to BibTeX file first 2. Update YAML header with citation format: \"Author et al. (YEAR) Journal. Vol(Issue):Pages\" 3. Include DOI</p> <p>Citation Format:</p> <pre><code># Citation: LastName F, et al. (YEAR) Journal Name. Vol(Issue):Pages\n# DOI: 10.####/######\n</code></pre>"},{"location":"cofactor_curation_methodology/#appendix-tools-and-resources","title":"Appendix: Tools and Resources","text":""},{"location":"cofactor_curation_methodology/#database-access","title":"Database Access","text":"Database Access Method Update Frequency ChEBI OWL download + API Monthly KEGG Web interface Quarterly BRENDA Web interface Annually ExplorEnz Web interface Annually MetaCyc Web interface Biannually"},{"location":"cofactor_curation_methodology/#scripts","title":"Scripts","text":"<ul> <li><code>scripts/generate_ingredient_cofactor_mapping.py</code> - Ingredient mapping generator</li> <li><code>scripts/validate_cofactor_hierarchy.py</code> - Quality control validator (TODO)</li> <li><code>scripts/update_chebi_ids.py</code> - ChEBI ID validator (TODO)</li> </ul>"},{"location":"cofactor_curation_methodology/#contacts","title":"Contacts","text":"<p>For questions about curation methodology: - GitHub Issues: https://github.com/CultureBotAI/MicroGrowAgents/issues - Maintainer: MicroGrowAgents Team</p> <p>Last Updated: 2025-01-10 Version: 1.0 Related Documentation: Cofactor Data Sources</p>"},{"location":"cofactor_data_sources/","title":"Cofactor Data Sources and KG-Microbe Integration","text":"<p>This document provides comprehensive documentation of the datasets, resources, and citations that inform the CofactorMediaAgent's cofactor analysis pipeline.</p>"},{"location":"cofactor_data_sources/#overview","title":"Overview","text":"<p>The CofactorMediaAgent integrates 6 major biological databases plus specialized literature to analyze cofactor requirements for microbial organisms. The system combines:</p> <ol> <li>Curated reference data (cofactor hierarchies, EC mappings)</li> <li>Organism genome data (Bakta annotations)</li> <li>Knowledge graph queries (KG-Microbe via KGReasoningAgent)</li> <li>Literature evidence (organism-specific mechanisms)</li> </ol>"},{"location":"cofactor_data_sources/#cofactor-analysis-pipeline","title":"Cofactor Analysis Pipeline","text":"<pre><code>Bakta GFF3 Genome Annotation\n         \u2193\nExtract EC Numbers (from genome_annotations table)\n         \u2193\nMap EC \u2192 Cofactors (ec_to_cofactor_map.yaml)\n         \u2193\nEnrich with Details (cofactor_hierarchy.yaml)\n         \u2193\nQuery KG-Microbe for Evidence (KGReasoningAgent)\n         \u251c\u2192 Enzyme-substrate relationships\n         \u251c\u2192 Biosynthesis pathway context\n         \u2514\u2192 Acquisition mechanisms (transporters)\n         \u2193\nMap to MP Ingredients (ingredient_cofactor_mapping.csv)\n         \u2193\nGenerate Hierarchical Table (CofactorMediaAgent._build_cofactor_table)\n</code></pre>"},{"location":"cofactor_data_sources/#primary-data-sources","title":"Primary Data Sources","text":"Resource Coverage Primary Use DOI Integration Point ChEBI 44 cofactors Chemical IDs, names, synonyms 10.1093/nar/gkv1031 <code>cofactor_hierarchy.yaml</code> IDs KEGG 30+ pathways Biosynthesis pathway definitions 10.1093/nar/gkac963 <code>cofactor_hierarchy.yaml</code> pathways EC Nomenclature 68 EC patterns Enzyme classification 10.1093/nar/gkn582 <code>ec_to_cofactor_map.yaml</code> BRENDA 68 EC mappings EC-cofactor relationships 10.1093/nar/gky1048 <code>ec_to_cofactor_map.yaml</code> KG-Microbe 1.5M nodes, 5.1M edges Enzyme-substrate queries N/A (project data) <code>KGReasoningAgent</code> runtime MP Medium CSV 158 ingredients Ingredient chemical properties Various (90.5% coverage) <code>ingredient_cofactor_mapping.csv</code>"},{"location":"cofactor_data_sources/#supporting-databases","title":"Supporting Databases","text":"<ul> <li>MetaCyc: Pathway-cofactor relationship validation (DOI: 10.1093/nar/gkz862)</li> <li>UniProt: Enzyme examples and annotations (DOI: 10.1093/nar/gkac1052)</li> <li>Reactome: Cofactor reaction roles (DOI: 10.1093/nar/gkab1028)</li> </ul>"},{"location":"cofactor_data_sources/#specialized-literature","title":"Specialized Literature","text":"<ul> <li>Lanthanide cofactors: Good NM, et al. (2019) J Biol Chem. 294(21):8437-8446 (DOI: 10.1074/jbc.RA119.008197)</li> <li>PQQ: Anthony C. (2001) Antioxid Redox Signal. 3(5):757-774 (DOI: 10.1089/15230860152664966)</li> <li>Methanogen cofactors: Thauer RK, et al. (2008) Nat Rev Microbiol. 6(8):579-591 (DOI: 10.1038/nrmicro1931)</li> </ul>"},{"location":"cofactor_data_sources/#reference-files","title":"Reference Files","text":""},{"location":"cofactor_data_sources/#1-cofactor_hierarchyyaml","title":"1. cofactor_hierarchy.yaml","text":"<p>Location: <code>src/microgrowagents/data/cofactor_hierarchy.yaml</code></p> <p>Content: 44 distinct cofactors organized into 5 functional categories: - Vitamins (14 cofactors): TPP, Biotin, Cobalamin, PLP, FMN, FAD, NAD/NADP, Folate, THF, Menaquinone, Ubiquinone, Lipoic acid - Metals (13 cofactors): Fe-S clusters, Heme (a/b/c/d1), Siroheme, Fe, Zn, Cu, Mg, Ca, Mn, Mo, Co, Ni, W, Lanthanides - Nucleotides (11 cofactors): NAD/NADH, NADP/NADPH, ATP, ADP, GTP, CTP, UTP - Energy Cofactors (7 cofactors): CoA, Acetyl-CoA, SAM, PAPS, cAMP, cGMP - Other Specialized (9 cofactors): PQQ, Methanofuran, H4MPT, CoM, CoB, Biotin CCCP, Retinal, Mycofactocin, F420, Methanophenazine</p> <p>Data Sources: - ChEBI IDs for all 44 cofactors - KEGG pathway IDs (30+ biosynthesis pathways: ko00730, ko00760, ko00780, etc.) - EC number associations (100+ enzyme-cofactor relationships) - Enzyme examples from UniProt - Specialized literature for rare cofactors</p> <p>Structure:</p> <pre><code>cofactor_hierarchy:\n  vitamins:\n    cofactors:\n      thiamine_pyrophosphate:\n        id: \"CHEBI:9532\"\n        names: [\"TPP\", \"ThDP\"]\n        precursor: \"thiamine\"\n        ec_associations: [\"2.2.1.-\", \"4.1.1.-\"]\n        kegg_pathways: [\"ko00730\"]\n</code></pre>"},{"location":"cofactor_data_sources/#2-ec_to_cofactor_mapyaml","title":"2. ec_to_cofactor_map.yaml","text":"<p>Location: <code>src/microgrowagents/data/ec_to_cofactor_map.yaml</code></p> <p>Content: 68 EC number patterns mapped to required and optional cofactors</p> <p>Data Sources: - BRENDA: Primary EC-to-cofactor relationship data - ExplorEnz: EC number classification and validation - MetaCyc: Pathway-based cofactor validation</p> <p>Pattern Matching: - Supports wildcards (e.g., <code>\"1.1.1.-\"</code> matches all EC 1.1.1.X enzymes) - Exact match takes precedence over pattern match - Pattern hierarchy: 4-level &gt; 3-level &gt; 2-level &gt; 1-level</p> <p>Example:</p> <pre><code>ec_cofactor_mapping:\n  \"1.1.1.-\": {primary: [\"nad\", \"nadp\"], optional: [\"zinc_ion\"]}\n  \"2.6.1.-\": {primary: [\"pyridoxal_phosphate\"]}\n</code></pre>"},{"location":"cofactor_data_sources/#3-ingredient_cofactor_mappingcsv","title":"3. ingredient_cofactor_mapping.csv","text":"<p>Location: <code>data/processed/ingredient_cofactor_mapping.csv</code></p> <p>Content: 13 MP medium ingredients identified as cofactor providers</p> <p>Generation Method: - NOT generated from KG-Microbe - Source: <code>data/raw/mp_medium_ingredient_properties.csv</code> (158 ingredients) - Method: Rule-based pattern matching on component names - Script: <code>scripts/generate_ingredient_cofactor_mapping.py</code></p> <p>Example Mappings:</p> <pre><code>MgCl\u2082\u00b76H\u2082O \u2192 magnesium_ion (CHEBI:18420)\nFeSO\u2084\u00b77H\u2082O \u2192 iron_ion, heme, iron_sulfur_clusters\nThiamin \u2192 thiamine_pyrophosphate (CHEBI:9532)\nCoCl\u2082\u00b76H\u2082O \u2192 cobalamin, cobalt_ion\n</code></pre>"},{"location":"cofactor_data_sources/#kg-microbe-integration","title":"KG-Microbe Integration","text":""},{"location":"cofactor_data_sources/#what-kg-microbe-is-used-for","title":"What KG-Microbe IS Used For","text":"<p>KG-Microbe (1.5M nodes, 5.1M edges) provides runtime evidence integration via the <code>KGReasoningAgent</code>:</p> <ol> <li>Enzyme-Substrate Relationship Queries</li> <li>SQL query pattern (USE CASE 3):      <code>sql      SELECT enzyme_id, enzyme_name, relationship      FROM kg_edges e      JOIN kg_nodes n ON e.subject = n.id      WHERE e.object = ? (substrate CHEBI ID)      AND e.predicate IN ('biolink:has_input', 'biolink:has_participant')      AND n.category = 'biolink:MolecularActivity'</code></li> <li> <p>Finds all enzymes using a specific cofactor substrate</p> </li> <li> <p>Biosynthesis Pathway Context</p> </li> <li>Query pathway completeness for cofactor biosynthesis capability</li> <li> <p>Determines if organism can produce cofactor de novo</p> </li> <li> <p>Acquisition Mechanisms</p> </li> <li>Transporter detection: Genome annotations + KG relationships</li> <li>Identifies uptake systems for external cofactors</li> <li> <p>Detects secreted chelators and binding molecules</p> </li> <li> <p>Multi-Source Evidence Integration</p> </li> <li>Combines genome, KG, literature, and KEGG data</li> <li>Confidence scoring based on evidence source count</li> <li>File: <code>src/microgrowagents/agents/cofactor_media_agent.py:183-237</code></li> </ol>"},{"location":"cofactor_data_sources/#what-kg-microbe-is-not-used-for","title":"What KG-Microbe is NOT Used For","text":"<ol> <li>Cofactor Hierarchy Definition</li> <li>Manually curated from ChEBI, KEGG, BRENDA databases</li> <li> <p>NOT derived from KG-Microbe relationships</p> </li> <li> <p>EC-to-Cofactor Mapping</p> </li> <li>BRENDA-based curation with ExplorEnz validation</li> <li> <p>Independent of KG-Microbe</p> </li> <li> <p>Ingredient Mapping Generation</p> </li> <li>Rule-based parsing of MP medium CSV</li> <li>Pattern matching on component names</li> <li>NO KG-Microbe queries involved</li> </ol>"},{"location":"cofactor_data_sources/#kgreasoningagent-query-patterns","title":"KGReasoningAgent Query Patterns","text":"<p>File: <code>src/microgrowagents/agents/kg_reasoning_agent.py</code></p> <p>Query capabilities: - USE CASE 1: Organism \u2192 Media \u2192 Ingredients pathway - USE CASE 2: Phenotype \u2192 Media recommendations - USE CASE 3: Enzyme-substrate relationships (cofactor analysis)</p> <p>Database: DuckDB-loaded KG data (<code>data/raw/kg_microbe_core/merged-kg_*.tsv</code>)</p> <p>Graph algorithms: GRAPE (Graph Representation leArning) for 10-100x performance</p>"},{"location":"cofactor_data_sources/#chebi-ontology-access","title":"ChEBI Ontology Access","text":"<p>Direct OWL file parsing (not through KG-Microbe): - Client: <code>src/microgrowagents/chemistry/api_clients/chebi_client.py</code> - Features: Exact + fuzzy matching, synonym support, normalization - Source: https://ftp.ebi.ac.uk/pub/databases/chebi/ontology/chebi.owl - Used for: Ingredient name \u2192 ChEBI ID matching</p>"},{"location":"cofactor_data_sources/#multi-source-evidence-integration","title":"Multi-Source Evidence Integration","text":"<p>The <code>CofactorMediaAgent.analyze_cofactor_requirements()</code> method integrates:</p> <ol> <li>Genome (Bakta GFF3 EC numbers)</li> <li>Direct SQL query: <code>genome_annotations</code> table</li> <li> <p>Method: <code>_get_ec_numbers_from_genome()</code></p> </li> <li> <p>KG-Microbe (pathway context)</p> </li> <li>Via <code>KGReasoningAgent</code> runtime queries</li> <li>Enzyme-substrate relationships</li> <li> <p>Biosynthesis pathway validation</p> </li> <li> <p>KEGG (biosynthesis completeness)</p> </li> <li>Reference data from <code>cofactor_hierarchy.yaml</code></li> <li> <p>Pathway IDs: ko00730, ko00760, etc.</p> </li> <li> <p>Literature (organism mechanisms)</p> </li> <li>Via <code>LiteratureAgent</code> searches</li> <li>Organism-specific evidence</li> </ol> <p>Confidence scoring: - High: 3-4 evidence sources agree - Medium: 2 evidence sources - Low: 1 evidence source</p>"},{"location":"cofactor_data_sources/#data-flow-in-cofactormediaagent","title":"Data Flow in CofactorMediaAgent","text":"<pre><code># Step 1: Extract EC numbers from genome\nec_numbers = self._get_ec_numbers_from_genome(organism)\n# Query: SELECT DISTINCT ec_numbers FROM genome_annotations WHERE genome_id = ?\n\n# Step 2: Map EC \u2192 Cofactors\nfor ec in ec_numbers:\n    cofactors = self._map_ec_to_cofactors(ec)\n    # Uses ec_to_cofactor_map.yaml with pattern matching\n\n# Step 3: Enrich with cofactor details\nfor cofactor_key in cofactors:\n    info = self._get_cofactor_info(cofactor_key)\n    # Loads from cofactor_hierarchy.yaml\n\n# Step 4: Query KG-Microbe (optional, for evidence)\n# Via KGReasoningAgent for enzyme-substrate relationships\n\n# Step 5: Map to MP ingredients\ningredient_mapping = self.map_ingredients_to_cofactors(requirements, \"MP\")\n# Uses ingredient_cofactor_mapping.csv\n\n# Step 6: Build hierarchical output table\ntable = self._build_cofactor_table(requirements, ingredient_mapping)\n</code></pre>"},{"location":"cofactor_data_sources/#coverage-metrics","title":"Coverage Metrics","text":"<ul> <li>Cofactors defined: 44 across 5 categories</li> <li>KEGG pathways referenced: 30+</li> <li>EC number associations: 100+</li> <li>EC pattern mappings: 68</li> <li>MP medium ingredients mapped: 13/158 (8.2% are cofactor providers)</li> <li>Pattern coverage: ~80% of common microbial enzymes</li> </ul>"},{"location":"cofactor_data_sources/#citation-summary","title":"Citation Summary","text":""},{"location":"cofactor_data_sources/#core-databases-required","title":"Core Databases (Required)","text":"<ol> <li>ChEBI: 10.1093/nar/gkv1031</li> <li>KEGG: 10.1093/nar/gkac963</li> <li>BRENDA: 10.1093/nar/gky1048</li> <li>ExplorEnz: 10.1093/nar/gkn582</li> </ol>"},{"location":"cofactor_data_sources/#supporting-databases_1","title":"Supporting Databases","text":"<ol> <li>MetaCyc: 10.1093/nar/gkz862</li> <li>UniProt: 10.1093/nar/gkac1052</li> <li>Reactome: 10.1093/nar/gkab1028</li> </ol>"},{"location":"cofactor_data_sources/#specialized-literature_1","title":"Specialized Literature","text":"<ol> <li>Lanthanides: 10.1074/jbc.RA119.008197</li> <li>PQQ: 10.1089/15230860152664966</li> <li>Methanogens: 10.1038/nrmicro1931</li> </ol> <p>For BibTeX format, see: <code>docs/references/cofactor_sources.bib</code></p>"},{"location":"cofactor_data_sources/#related-documentation","title":"Related Documentation","text":"<ul> <li>Cofactor Curation Methodology - Detailed curation workflow</li> <li>CofactorMediaAgent API - Implementation</li> <li>KGReasoningAgent - KG-Microbe integration</li> <li>MP Medium Dataset - Source ingredient data</li> </ul>"},{"location":"cofactor_data_sources/#version-history","title":"Version History","text":"<ul> <li>v1.0 (2025-01-10): Initial documentation with comprehensive citations and KG-Microbe integration details</li> </ul>"},{"location":"grape_installation/","title":"GRAPE Installation Guide","text":"<p>This guide provides detailed instructions for installing GRAPE (Graph Representation leArning, Predictions and Evaluations) for use with MicroGrowAgents' KG reasoning capabilities.</p>"},{"location":"grape_installation/#what-is-grape","title":"What is GRAPE?","text":"<p>GRAPE is a high-performance graph analysis library developed by AnacletoLAB with a Rust backend (ensmallen) that provides:</p> <ul> <li>10-100x faster graph algorithms compared to NetworkX</li> <li>Memory efficient: ~800MB vs ~2GB for 5M edge graphs</li> <li>Direct TSV loading: 5-15s vs 60s for large graphs</li> <li>Parallel algorithms: Optimized for biological networks</li> <li>Built-in embeddings: Node2Vec, DeepWalk, etc.</li> </ul> <p>Repository: https://github.com/AnacletoLAB/grape</p>"},{"location":"grape_installation/#platform-support","title":"Platform Support","text":""},{"location":"grape_installation/#fully-supported-pre-built-wheels-available","title":"\u2705 Fully Supported (Pre-built Wheels Available)","text":"<ul> <li>Linux x86_64 (Ubuntu, CentOS, Debian, etc.)</li> <li>Python 3.8, 3.9, 3.10, 3.11</li> <li> <p>Recommended: Ubuntu 20.04+ or CentOS 7+</p> </li> <li> <p>Windows x86_64 (limited support)</p> </li> <li>Python 3.8, 3.9, 3.10</li> <li>Requires Visual C++ Build Tools</li> </ul>"},{"location":"grape_installation/#partial-support-requires-compilation","title":"\u26a0\ufe0f Partial Support (Requires Compilation)","text":"<ul> <li>macOS ARM64 (Apple Silicon M1/M2/M3)</li> <li>Requires Rust toolchain</li> <li>May have compilation issues with Python 3.11+</li> <li> <p>Workaround: Use Conda or Rosetta 2</p> </li> <li> <p>macOS x86_64 (Intel)</p> </li> <li>Requires Rust toolchain</li> <li>Better success rate than ARM64</li> </ul>"},{"location":"grape_installation/#not-supported","title":"\u274c Not Supported","text":"<ul> <li>Python 3.12+ (as of GRAPE 0.2.5)</li> <li>32-bit systems</li> <li>BSD systems</li> </ul>"},{"location":"grape_installation/#installation-methods","title":"Installation Methods","text":""},{"location":"grape_installation/#method-1-pip-install-easiest-for-supported-platforms","title":"Method 1: pip install (Easiest - For Supported Platforms)","text":"<pre><code># Standard installation (uses pre-built wheels if available)\npip install grape\n\n# Or with uv (recommended)\nuv pip install grape\n\n# Verify installation\npython -c \"from grape import Graph; print('GRAPE installed successfully')\"\n</code></pre> <p>Expected output:</p> <pre><code>GRAPE installed successfully\n</code></pre> <p>If you see <code>ImportError: cannot import name 'ensmallen_default'</code>, proceed to Method 2 or 3.</p>"},{"location":"grape_installation/#method-2-conda-recommended-for-macos","title":"Method 2: Conda (Recommended for macOS)","text":"<p>Conda provides pre-built binaries for more platform combinations:</p> <pre><code># Create a new conda environment (recommended)\nconda create -n microgrow python=3.10\nconda activate microgrow\n\n# Install GRAPE from conda-forge\nconda install -c conda-forge grape\n\n# Verify installation\npython -c \"from grape import Graph; print('GRAPE installed successfully')\"\n</code></pre> <p>Advantages: - Pre-built for macOS ARM64 and x86_64 - Handles Rust dependencies automatically - Better platform compatibility</p>"},{"location":"grape_installation/#method-3-build-from-source-for-unsupported-platforms","title":"Method 3: Build from Source (For Unsupported Platforms)","text":"<p>If pre-built wheels are not available, you can compile from source:</p>"},{"location":"grape_installation/#prerequisites","title":"Prerequisites","text":"<p>1. Install Rust toolchain:</p> <pre><code># macOS and Linux\ncurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\nsource $HOME/.cargo/env\n\n# Verify Rust installation\nrustc --version\ncargo --version\n</code></pre> <p>2. Install build dependencies:</p> <pre><code># macOS\nxcode-select --install\n\n# Ubuntu/Debian\nsudo apt-get update\nsudo apt-get install build-essential python3-dev\n\n# CentOS/RHEL\nsudo yum groupinstall \"Development Tools\"\nsudo yum install python3-devel\n</code></pre>"},{"location":"grape_installation/#compile-and-install","title":"Compile and Install","text":"<pre><code># Build from source (no pre-built wheels)\npip install --no-binary grape,ensmallen grape\n\n# This will take 10-30 minutes\n# Expected output:\n#   Building wheels for collected packages: ensmallen, grape\n#   Building wheel for ensmallen (setup.py) ... (this is slow)\n</code></pre> <p>Troubleshooting compilation:</p> <p>If compilation fails with \"cargo build failed\":</p> <pre><code># Try with more memory allocated to Rust\nexport CARGO_BUILD_JOBS=2  # Reduce parallel jobs\npip install --no-binary grape,ensmallen grape\n\n# Or build ensmallen separately\npip install --no-binary ensmallen ensmallen\npip install grape\n</code></pre>"},{"location":"grape_installation/#method-4-rosetta-2-macos-arm64-workaround","title":"Method 4: Rosetta 2 (macOS ARM64 Workaround)","text":"<p>For Apple Silicon Macs, you can run x86_64 Python under Rosetta 2:</p> <pre><code># Install x86_64 Python using pyenv\narch -x86_64 /bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\narch -x86_64 brew install python@3.10\n\n# Create x86_64 virtual environment\narch -x86_64 /usr/local/bin/python3.10 -m venv .venv-x86\nsource .venv-x86/bin/activate\n\n# Install GRAPE (will use x86_64 wheels)\npip install grape\n\n# Verify\npython -c \"from grape import Graph; print('GRAPE installed (x86_64 mode)')\"\n</code></pre>"},{"location":"grape_installation/#verifying-grape-installation","title":"Verifying GRAPE Installation","text":""},{"location":"grape_installation/#basic-import-test","title":"Basic Import Test","text":"<pre><code>from grape import Graph\nprint(f\"GRAPE version: {Graph.__module__}\")\n</code></pre>"},{"location":"grape_installation/#create-test-graph","title":"Create Test Graph","text":"<pre><code>from grape import Graph\nimport tempfile\nfrom pathlib import Path\n\n# Create test data\nnodes_data = \"\"\"id\\ttype\nA\\ttype1\nB\\ttype1\nC\\ttype2\n\"\"\"\n\nedges_data = \"\"\"source\\tdestination\\ttype\nA\\tB\\trelates_to\nB\\tC\\trelates_to\n\"\"\"\n\n# Write to temporary files\nwith tempfile.NamedTemporaryFile(mode='w', suffix='.tsv', delete=False) as f:\n    f.write(nodes_data)\n    nodes_file = f.name\n\nwith tempfile.NamedTemporaryFile(mode='w', suffix='.tsv', delete=False) as f:\n    f.write(edges_data)\n    edges_file = f.name\n\n# Load graph\ngraph = Graph.from_csv(\n    directed=True,\n    edge_path=edges_file,\n    edge_list_separator='\\t',\n    edge_list_header=True,\n    sources_column='source',\n    destinations_column='destination',\n    node_path=nodes_file,\n    node_list_separator='\\t',\n    node_list_header=True,\n    nodes_column='id',\n    name='test_graph'\n)\n\nprint(f\"Nodes: {graph.get_number_of_nodes()}\")\nprint(f\"Edges: {graph.get_number_of_edges()}\")\nprint(\"\u2713 GRAPE working correctly!\")\n\n# Cleanup\nPath(nodes_file).unlink()\nPath(edges_file).unlink()\n</code></pre> <p>Expected output:</p> <pre><code>Nodes: 3\nEdges: 2\n\u2713 GRAPE working correctly!\n</code></pre>"},{"location":"grape_installation/#common-installation-issues","title":"Common Installation Issues","text":""},{"location":"grape_installation/#issue-1-importerror-cannot-import-name-ensmallen_default","title":"Issue 1: <code>ImportError: cannot import name 'ensmallen_default'</code>","text":"<p>Symptom:</p> <pre><code>from grape import Graph\n# ImportError: cannot import name 'ensmallen_default' from partially initialized module 'ensmallen'\n</code></pre> <p>Cause: Ensmallen Rust module didn't compile or isn't compatible with your Python version.</p> <p>Solutions: 1. Check Python version: <code>python --version</code> (must be \u22643.11) 2. Try Conda installation (Method 2) 3. Build from source (Method 3) 4. Use Rosetta 2 on ARM64 Mac (Method 4)</p>"},{"location":"grape_installation/#issue-2-modulenotfounderror-no-module-named-grape","title":"Issue 2: <code>ModuleNotFoundError: No module named 'grape'</code>","text":"<p>Solution:</p> <pre><code># Ensure grape is installed in active environment\npip list | grep grape\n\n# If not found, install\npip install grape\n</code></pre>"},{"location":"grape_installation/#issue-3-compilation-fails-with-cargo-build-failed","title":"Issue 3: Compilation fails with \"cargo build failed\"","text":"<p>Symptoms:</p> <pre><code>error: could not compile `ensmallen`\ncargo build failed\n</code></pre> <p>Solutions:</p> <ol> <li> <p>Reduce parallel jobs:    <code>bash    export CARGO_BUILD_JOBS=2    pip install --no-binary grape,ensmallen grape</code></p> </li> <li> <p>Install older Rust:    <code>bash    rustup install 1.70.0    rustup default 1.70.0    pip install --no-binary grape,ensmallen grape</code></p> </li> <li> <p>Use Conda instead (recommended)</p> </li> </ol>"},{"location":"grape_installation/#issue-4-arm64-macos-specific-issues","title":"Issue 4: ARM64 macOS specific issues","text":"<p>Problem: Pre-built wheels not available for ARM64 + Python 3.11</p> <p>Best solution: Use Conda</p> <pre><code>conda create -n microgrow python=3.10\nconda activate microgrow\nconda install -c conda-forge grape\n</code></pre> <p>Alternative: Use Rosetta 2 (Method 4)</p>"},{"location":"grape_installation/#testing-grape-with-kg-microbe","title":"Testing GRAPE with KG-Microbe","text":"<p>Once GRAPE is installed, test with MicroGrowAgents:</p> <pre><code># Run graph builder tests\nuv run pytest tests/test_kg/test_graph_builder.py -v\n\n# If GRAPE is working, all tests should pass\n# If not installed, tests will skip with helpful messages\n</code></pre>"},{"location":"grape_installation/#quick-test-script","title":"Quick Test Script","text":"<pre><code>from microgrowagents.kg.graph_builder import GraphBuilder, GRAPE_AVAILABLE\n\nif GRAPE_AVAILABLE:\n    print(\"\u2713 GRAPE is available and ready!\")\n    print(\"  You can use high-performance graph algorithms.\")\nelse:\n    print(\"\u26a0 GRAPE is not available on this system.\")\n    print(\"  Graph builder will use fallback mode.\")\n    print(\"  See docs/grape_installation.md for installation help.\")\n</code></pre>"},{"location":"grape_installation/#performance-benchmarks","title":"Performance Benchmarks","text":"<p>Comparison of GRAPE vs NetworkX on KG-Microbe (1.5M nodes, 5.1M edges):</p> Operation NetworkX GRAPE Speedup Graph loading 60-120s 5-15s 8-24x Memory usage ~2GB ~800MB 2.5x less Shortest path 800ms 8-80ms 10-100x Betweenness centrality 180s 3.6s 50x PageRank 45s 2.3s 20x <p>Note: Benchmarks on Ubuntu 20.04 x86_64 with Python 3.10</p>"},{"location":"grape_installation/#fallback-option-networkx","title":"Fallback Option: NetworkX","text":"<p>If GRAPE cannot be installed, MicroGrowAgents provides automatic fallback to NetworkX:</p> <pre><code># This will work even without GRAPE\nfrom microgrowagents.kg.graph_builder import GraphBuilder\n\nbuilder = GraphBuilder(db_path)\n# Will use NetworkX if GRAPE unavailable (with warning)\n</code></pre> <p>Trade-offs: - \u2705 Pure Python (no compilation needed) - \u2705 Works on all platforms - \u274c 10-100x slower for large graphs - \u274c Higher memory usage (~2GB for KG-Microbe)</p>"},{"location":"grape_installation/#recommended-setup-by-platform","title":"Recommended Setup by Platform","text":""},{"location":"grape_installation/#ubuntudebian-linux-x86_64","title":"Ubuntu/Debian Linux (x86_64)","text":"<pre><code># Easiest - pre-built wheels available\npip install grape\n</code></pre>"},{"location":"grape_installation/#centosrhel-linux-x86_64","title":"CentOS/RHEL Linux (x86_64)","text":"<pre><code># Pre-built wheels available\npip install grape\n</code></pre>"},{"location":"grape_installation/#macos-arm64-m1m2m3","title":"macOS ARM64 (M1/M2/M3)","text":"<pre><code># Use Conda (recommended)\nconda install -c conda-forge grape\n\n# OR use Rosetta 2\narch -x86_64 python3.10 -m venv .venv-x86\nsource .venv-x86/bin/activate\npip install grape\n</code></pre>"},{"location":"grape_installation/#macos-intel-x86_64","title":"macOS Intel (x86_64)","text":"<pre><code># Conda recommended\nconda install -c conda-forge grape\n\n# Or build from source\npip install --no-binary grape grape\n</code></pre>"},{"location":"grape_installation/#windows-x86_64","title":"Windows x86_64","text":"<pre><code># Install Visual C++ Build Tools first\n# https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019\n\npip install grape\n</code></pre>"},{"location":"grape_installation/#support-and-resources","title":"Support and Resources","text":"<ul> <li>GRAPE GitHub: https://github.com/AnacletoLAB/grape</li> <li>Documentation: https://anacletolab.github.io/grape/</li> <li>Issues: https://github.com/AnacletoLAB/grape/issues</li> <li>Paper: Cappelletti et al., \"GRAPE: fast and scalable Graph Processing and Embedding\"</li> </ul>"},{"location":"grape_installation/#contact","title":"Contact","text":"<p>For MicroGrowAgents-specific GRAPE issues: - Open an issue on the MicroGrowAgents repository - Include: OS, Python version, GRAPE installation method, error message</p>"},{"location":"grape_installation/#quick-reference","title":"Quick Reference","text":"<pre><code># Check if GRAPE is installed\npython -c \"from grape import Graph; print('\u2713 GRAPE OK')\"\n\n# Check Python version (must be \u22643.11)\npython --version\n\n# Check system architecture\nuname -m\n\n# Install GRAPE (Linux x86_64)\npip install grape\n\n# Install GRAPE (macOS, any arch)\nconda install -c conda-forge grape\n\n# Build from source\npip install --no-binary grape,ensmallen grape\n\n# Test with MicroGrowAgents\nuv run pytest tests/test_kg/test_graph_builder.py -v\n</code></pre>"}]}